# SPDX-FileCopyrightText: 2025 Deutsche Telekom AG (opensource@telekom.de)
#
# SPDX-License-Identifier: Apache-2.0

import pytest
import requests_mock

GET_RESULT_INFO = '{"model_id":"/data/multilingual-e5-large/","model_sha":null,"model_dtype":"float32","model_type":{"embedding":{"pooling":"mean"}},"max_concurrent_requests":512,"max_input_length":512,"max_batch_tokens":16352,"max_batch_requests":null,"max_client_batch_size":512,"tokenization_workers":2,"version":"1.2.0","sha":"3edace22f22d5dab32d421034683183953fe5061","docker_label":"sha-3edace2"}'  # noqa: E501
GET_RESULT_INFO_DICT = {
    "model_id": "/data/multilingual-e5-large/",
    "model_sha": None,
    "model_dtype": "float32",
    "model_type": {"embedding": {"pooling": "mean"}},
    "max_concurrent_requests": 512,
    "max_input_length": 512,
    "max_batch_tokens": 16352,
    "max_batch_requests": None,
    "max_client_batch_size": 512,
    "tokenization_workers": 2,
    "version": "1.2.0",
    "sha": "3edace22f22d5dab32d421034683183953fe5061",
    "docker_label": "sha-3edace2",
}

GET_RESULT_INFO_STR = '{"model_id":"%s","model_sha":"None","model_dtype":"float32","model_type":{"embedding":{"pooling":"mean"}},"max_concurrent_requests":512,"max_input_length":512,"max_batch_tokens":16352,"max_batch_requests":"None","max_client_batch_size":512,"tokenization_workers":2,"version":"1.2.0","sha":"3edace22f22d5dab32d421034683183953fe5061","docker_label":"sha-3edace2"}'  # noqa: E501
POST_RESULT_EMBEDDING_STR = "[[-0.056849957,-0.3586044,-0.52350885,-0.3713164,-0.39045823,-0.43097273,1.52254,-0.3386638,-0.19976276,-0.72029287,0.17595924,-0.032839056,-0.48097992,0.23513375,-0.059350654,0.68784845,1.1052303,-0.6333549,0.5131381,0.22863281,0.035981078,-0.35369992,0.21889326,0.19433512,-0.4515322,0.7306852,-0.5792075,0.01805654,0.38655314,0.6548673,0.8036326,-0.09868637,-0.8004115,-1.3650824,-0.841449,-0.10027425,-0.21986485,0.28125355,-0.16832821,0.8798454,-0.2932722,0.365811,0.014080455,0.5448775,0.05547349,0.55699486,0.0466638,0.25136,0.0189517,1.3088377,-0.117058426,0.594703,-0.10365698,-0.026343308,0.28755116,-1.0565972,-0.08285768,0.47254893,0.028171027,0.7725548,-0.30978176,-0.028417233,0.2907433,0.491789,0.4101759,-1.0319293,0.4322688,0.05703587,0.48109022,-0.56826115,-0.06050111,0.3224232,0.47454914,0.63842654,0.28398117,0.45070434,-0.82370424,0.6370867,0.4856279,0.9188818,0.6448567,0.054710697,0.37065515,0.05102056,-1.1170492,0.117849655,-0.3407689,0.85745424,0.014086895,-0.13397337,-0.6675181,0.41681322,-0.54981697,0.06197727,-0.16532135,-0.2108472,0.07190929,0.28133875,0.004494693,-0.7001077,-0.3215443,0.019973986,0.38919336,-0.36696514,-0.12182281,-0.13465288,-0.069702454,-0.41797018,0.6844066,0.26295722,-0.8134041,0.6295222,-0.48061547,-0.11959325,-0.9308447,-0.030804995,-0.31626865,-0.52911985,0.21468574,-0.06317907,-0.3226198,0.6031561,0.51362383,-0.37086332,-0.21325643,-0.19997276,-0.5181802,1.3709563,0.5400352,0.18530919,0.892778,-0.056844164,0.122769184,0.2843215,0.59680885,-0.031667303,-0.037306454,0.11336911,-0.6366849,0.19657259,0.53129035,0.5407483,-0.17947803,-0.69371104,-0.80304587,0.95989007,-0.2461622,0.17947036,-0.45479143,-0.029709537,-0.002226131,0.6024557,0.4192747,-0.30716932,-0.5073463,-0.064691804,-0.05311853,-0.37826923,-0.08741081,0.8681864,0.5417119,1.276816,-0.49793303,0.39190242,-0.47001275,-0.467296,0.13330969,0.1532976,0.08612059,0.3297875,-0.9821142,-0.19979656,0.5792175,0.31950197,-0.19735843,-0.22540466,-0.22181532,-0.5253601,-0.76283574,0.593135,-0.08126011,-0.43294987,-0.06272331,-0.56739485,0.39848542,-0.80094415,0.35242897,0.04675463,-0.66042817,0.09332116,0.14968456,0.90806925,0.23861603,0.21055496,0.07175192,0.20278549,0.23101898,1.3012751,0.7311259,-0.036260538,0.07794953,0.0061612916,0.16756204,-0.081094675,-0.5027836,0.8638427,-0.096245065,0.6162166,-0.082979135,0.8485298,0.69663787,0.5569635,0.11519936,0.77648187,0.14622904,0.240403,-0.41829517,0.27255198,-0.15047865,0.37348476,0.9466523,-0.8159938,0.46878016,-0.012156441,0.82376283,0.6322779,0.17169397,0.21293491,0.1953075,0.3637754,-0.9333801,0.92475146,-0.61743265,1.2676855,0.17516705,0.15028326,-0.8040979,0.7474273,0.4246707,0.061500166,0.7068927,0.8508218,0.4021519,-0.5740135,0.058822494,0.6287833,-0.46627536,-0.062833644,0.0114584,0.47111,-0.07822092,-1.3080904,-0.19817822,0.22293966,0.1758154,-0.72400486,-0.28969392,0.11318234,-0.281013,0.09225459,-0.08338553,0.09962973,-0.25571617,-0.08283607,2.0883815,-0.02375003,0.15596327,-0.35358223,-0.0035290122,0.23688158,0.67723894,0.8895593,-0.11624885,-0.89779013,-0.11992208,-0.50940365,0.16802217,0.71113604,-0.011601456,0.6699209,0.7881466,0.661882,0.3361343,0.1875342,-0.1901528,-0.50410825,0.18608795,-0.35624492,-0.96955955,0.191933,-0.14471488,-0.05699649,0.1052911,-0.18241063,0.40935203,0.0711322,-0.33488885,0.5723441,0.11871506,0.103393756,0.3228413,0.0058626765,-0.10633512,0.6955181,3.8172436,0.45352653,-0.15278499,0.78282213,0.6222844,-0.44305643,-0.40547004,1.7654634,0.7183707,-0.36906412,-0.60719395,-0.6127194,0.08117926,-1.6528347,-0.5097668,0.6791237,-0.14776489,-0.08597268,-0.24338701,0.029057004,-0.9126902,-0.122194625,-0.080486864,0.7248066,0.5660796,0.3473274,0.050370175,0.022572342,-0.8136796,-0.8785508,0.5214532,0.32044545,-0.36493063,0.15046811,-0.37923265,0.290528,-1.041531,-1.5026848,0.21733885,0.2045185,-0.34682837,0.068585046,-0.041339017,-0.08653817,-0.32506242,-0.06816155,0.30322146,0.22605945,0.36049336,0.15521735,-0.41803956,0.1959996,-0.1457853,-0.0036049893,-0.4794679,-0.052666932,0.777851,0.87491924,-0.118002266,-1.0468242,0.18292986,0.3898902,0.8076021,0.872441,0.66161495,0.3986081,0.23960863,-0.2848248,0.29363173,-0.018646296,0.05531877,-0.08433529,-0.36899948,0.41713816,-0.6734914,-0.013857499,-0.0035842827,-0.7063616,-0.7237958,-0.082395956,0.47829652,0.6105943,0.37108776,0.6446792,-0.010964834,0.23101136,-1.1284403,0.022637555,0.24152441,0.21645294,-0.8495696,-0.25834012,-0.6769585,-0.7095366,0.75479764,0.6565591,0.21010871,0.5203816,-0.5264215,0.5292498,-0.5223717,-0.05718133,-0.083691664,0.042829614,-0.33245975,0.1894659,0.53618807,0.06094422,0.464063,0.20381318,0.30758974,0.5276324,-0.6679442,0.13664718,-0.38863707,0.2692294,-0.5429106,0.07157322,0.265997,-0.25895256,0.36281857,-0.5096377,-0.3772557,-0.99428576,0.05526902,0.116519965,-0.8622558,0.2575462,-0.3065464,0.53031945,0.08453838,-0.7769334,-0.16330644,-0.56559706,-0.5287315,0.3137982,0.24827987,0.24432418,1.3651434,0.3274687,0.12088807,-0.13503566,0.40007216,0.4252166,-0.97456944,-1.1183866,0.3198433,0.15030038,0.24855974,-0.011397646,0.0067205327,-0.40482414,-0.072959825,0.54442364,-0.057330165,-0.6287329,-0.0170237,0.099911734,-0.6036679,-0.03485626,1.1017925,0.09433409,0.4535521,-0.9115106,0.3533791,-0.42223522,1.082895,-0.5649455,-0.26018235,0.083617225,-0.9297119,-0.6373662,0.036455676,0.042787824,0.33366665,0.204013,0.16553527,-0.27746648,-0.7178194,-0.5749113,0.25688207,0.21746612,-0.8328264,-0.36690953,0.58235687,0.13357194,0.61564004,0.51025987,-0.411235,0.37257403,-0.5109076,0.6323845,-0.5957354,-0.5258623,-0.1575354,0.31771863,0.5489642,-0.26550472,-0.9145486,0.9514854,0.61046,0.61326396,0.77207005,-0.22009894,1.0578716,0.09096114,0.22864515,-1.0327548,0.371425,0.9745567,0.2642503,0.49444488,-0.6337154,-0.91257244,0.4919174,-0.12794767,0.14476117,0.061365373,0.25331825,0.6821323,0.5937395,0.91448164,-0.8134946,0.5725955,-0.31814474,0.21509278,-0.51318556,-0.4631877,-0.085547194,-0.08415233,-0.5913995,-0.18014725,-0.07687944,-0.2881833,0.24813697,0.27117682,0.5453132,-0.22314502,0.63594383,0.20479168,0.3615553,0.035010833,0.24996686,0.5356124,-0.109455444,0.56450063,0.6821466,0.34730902,0.08078773,-0.85017276,-0.25936154,0.11412656,0.24414472,0.076925606,0.73956144,-0.0677111,-0.014227483,0.35687616,-0.59151787,0.19560142,-0.07390567,0.44663498,1.4499463,-0.08755987,0.09971967,-0.022227582,0.045601375,-0.45666942,-0.780054,0.8097257,-0.13206838,0.2329344,0.47035766,-0.5804712,-0.852105,0.33322275,0.45386565,0.558398,-0.14195296,0.088029474,-1.0882301,0.6540312,0.7172599,-0.99143285,-0.23571607,0.25321627,0.19120033,0.2811812,-0.47779533,-0.731697,0.82973766,0.5083272,-0.0011762351,-0.56788343,0.5043183,-0.5089109,-0.07558789,0.48887494,0.087404676,-0.23686086,0.41706857,0.8483127,0.5532121,-0.87362176,-0.4683935,0.6796435,0.08967891,0.58955204,0.05856125,-0.37920186,-0.52909064,-0.87300825,1.4236325,0.025678447,-0.13557453,0.19552459,0.66782457,0.7762784,0.006411484,-0.26379114,0.21515726,0.026647558,-0.38198215,-0.3562973,-0.17596169,0.96736556,-0.10091157,-0.12392625,1.0681807,0.71037984,-0.2474801,-0.7574249,0.15428196,0.09895474,0.3731758,0.090526395,0.83990675,0.3387635,-0.60168016,0.49239126,-1.0100573,0.09605226,-0.17070933,0.28172848,-0.17825599,0.18032649,-0.025842719,0.235995,1.0492911,-0.45095825,1.4797472,0.025115365,-0.06490559,-0.46977317,0.613058,0.05198435,-0.4519252,0.90006703,-0.45987368,-1.0453544,0.095336184,-0.13932578,0.46680558,0.05488153,-0.5136896,-0.966115,0.27835843,0.2988981,-0.16572775,0.74337167,-0.193156,-0.13080439,0.8035629,0.3740557,0.18685094,0.1435167,-0.63009846,0.14691049,-0.3482637,-0.21919757,0.43799055,1.0346355,-0.028076997,1.1018783,-0.6838257,0.50995344,-0.41828728,0.1837702,0.070693284,-0.734863,0.124221414,-0.25724798,-0.13771595,-0.19758353,-0.32825926,-0.5011891,0.11025958,0.42678085,-0.5649059,0.47167346,-0.5351515,0.23684381,0.1427919,0.30727822,-0.6180262,0.73347604,0.08724561,1.0511851,-0.6262624,-0.41672832,0.06698874,0.46009213,-0.42282486,-0.20072311,0.04311282,-0.32356748,0.063127935,0.13004246,0.16335854,-0.37277663,-0.21001372,0.7058543,-0.5033001,-0.5753824,0.11126945,0.3332815,-0.02611374,-0.18061641,0.23787682,-0.72294235,-0.5399139,-0.06198354,-0.41295135,-0.9136099,0.4948374,-0.14360547,-0.14925343,-0.29599068,0.3427353,-0.013181774,-0.07481706,-0.08586951,-0.10979103,0.4224532,-0.082688294,-0.15535048,1.1565557,0.35287246,-0.3662097,-0.08707079,-0.47541392,-0.38259283,0.6139773,-0.046778407,-0.02385359,1.1040108,0.34167948,0.3334826,-0.9576479,-0.48613757,-0.15376593,0.1653939,0.08146529,0.13942748]]"  # noqa: E501


@pytest.fixture(scope="function")
def embedding_service_mock():
    with requests_mock.Mocker() as m:
        m.post("/embed", text=POST_RESULT_EMBEDDING_STR)
        m.get("/info", text=GET_RESULT_INFO)
        yield
